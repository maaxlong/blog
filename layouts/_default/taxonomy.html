{{ define "main" }}
<div class="content-with-sidebar">
  <div class="main-content">
    <h1 class="taxonomy-title">
  {{ if .Data.Singular }}
    {{ lower .Data.Singular }}: {{ lower .Title }}
  {{ else }}
    {{ lower .Title }}
  {{ end }}
	</h1>

    {{/* Only show posts from post(s) sections, newest first, paginated */}}
    {{ $posts := where .Pages "Section" "in" (slice "post" "posts") }}
    {{ $p := .Paginate ($posts.ByDate.Reverse) }}

    {{ range $p.Pages }}
      <article class="post-summary h-entry">
        <h2 class="p-name"><a href="{{ .Permalink }}">{{ .Title }}</a></h2>

        <p class="post-meta">
          <time class="dt-published" datetime="{{ .Date }}">{{ .Date | time.Format "2 January 2006, 3:04 pm" }}</time>
          {{ with .Params.tags }}
            &nbsp;·&nbsp;Tags:
            {{ range $i, $tag := . }}
              {{ if $i }}, {{ end }}
              <a class="tag" href="{{ (printf "tags/%s/" (urlize $tag)) | relLangURL }}">#{{ $tag }}</a>
            {{ end }}
          {{ end }}
        </p>

        {{ with .Summary }}
          <div class="home-post-content">
            {{ . | safeHTML }}
          </div>
        {{ end }}

        <a class="read-more" href="{{ .Permalink }}">Read more →</a>
      </article>
    {{ end }}

    {{/* Simple inline pagination (no _internal dependency) */}}
    {{ if gt $p.TotalPages 1 }}
      <nav class="pagination" aria-label="Pagination">
        {{ if $p.HasPrev }}<a class="newer" href="{{ $p.Prev.URL }}">&larr; Newer</a>{{ end }}
        <span class="pages">
          {{ range $p.Pagers }}
            {{ if eq . $p }}
              <span class="page current">{{ .PageNumber }}</span>
            {{ else }}
              <a class="page" href="{{ .URL }}">{{ .PageNumber }}</a>
            {{ end }}
          {{ end }}
        </span>
        {{ if $p.HasNext }}<a class="older" href="{{ $p.Next.URL }}">Older &rarr;</a>{{ end }}
      </nav>
    {{ end }}
  </div>

  {{ partial "sidebar.html" . }}
</div>
{{ end }}